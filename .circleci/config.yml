version: 2

jobs:
  build:
    docker:
      - image: thibautschaeffer/zokrates-test:latest
    steps:
      # - checkout
      # - run:
      #     name: Build libsnark
      #     command: LIBSNARK_SOURCE_PATH=$HOME/libsnark ./build_libsnark.sh
      # - run: curl https://sh.rustup.rs -sSf | sh -s -- --default-toolchain nightly-2018-06-03 -y && source $HOME/.cargo/env
      # - run:
      #     name: Version information
      #     command: source $HOME/.cargo/env && rustc --version; cargo --version; rustup --version
      # - run:
      #     name: Calculate dependencies
      #     command: source $HOME/.cargo/env && cargo generate-lockfile
      # - restore_cache:
      #     keys:
      #       - v4-cargo-cache-{{ arch }}-{{ checksum "Cargo.lock" }}
      - run:
          name: Run tests
          command: cd $HOME/ZoKrates && cargo test --release -- --nocapture
          timeout: 30m
          no_output_timeout: 30m
      # - save_cache:
      #     paths:
      #       - /usr/local/cargo/registry
      #       - target/debug/.fingerprint
      #       - target/debug/build
      #       - target/debug/deps
      #     key: v4-cargo-cache-{{ arch }}-{{ checksum "Cargo.lock" }}