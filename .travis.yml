# Based on the "trust" template v0.1.2
# https://github.com/japaric/trust/tree/v0.1.2

dist: trusty
language: rust
rust:
  - nightly
services: docker
sudo: required

env:
  global:
    - CRATE_NAME=zokrates

matrix:
  include:
    # Linux
    # - env: TARGET=aarch64-unknown-linux-gnu
    # - env: TARGET=arm-unknown-linux-gnueabi
    # - env: TARGET=i686-unknown-linux-gnu
    # - env: TARGET=x86_64-unknown-linux-gnu

    # # OSX
    # - env: TARGET=i686-apple-darwin
    #   os: osx
    # - env: TARGET=x86_64-apple-darwin
    #   os: osx

    # # *BSD
    # - env: TARGET=x86_64-unknown-freebsd

    - env: TARGET=x86_64-pc-windows-gnu
    - env: TARGET=x86_64-pc-windows-msvc

before_install:
  - set -e
  - rustup self update

install:
  - sh ci/install.sh
  - source ~/.cargo/env || true

script:
  - bash ci/script.sh

after_script: set +e

before_deploy:
  - sh ci/before_deploy.sh

deploy:
  provider: s3
  access_key_id: "AKIAITSVMKXUVHEDEPLQ"
  secret_access_key:
    secure: c5x4yaXDKdXdRiucNzFhoCBm8B3dJuRPpIn6rFD0IjaFR2c1Psc6rlHFDU0vBETq4kuATrjod7otyf0z0sqh3OacXvcTKjhoH86fmhbZrgaaMTLxMZBkQ6cICyudjkvol/IzTpbSptibsrqEsrPERYdYsgrXXlx7vgxHqjlMPYl+YmMNl2kwgDLla84tjQy0L1e/U/mLr7BTCEok2idSFxaPHSgB9xUcjlIZfKuEqnQdPntQiUn9672i6lQ2PW/QmnvF2EL7Jp9s5UTaT3eAR5Sq1hKHXfFMWRVkOBwvESH7lqDSl3t3NmR2lmzzvFe+O7jOQOtIjZHJ4CkiCvjLVxD6PrwqSjTFp0UNOHvgsWp15DQDYPRBmSkfCq767Di8mqALdr7ORGajcjUBKaZ8xGDPaqWo9jc/zksRa5dePNQMC3XB67/q9LFJqXwg23Cd22DuKo4wqgXbvQrnDSUiz/AIXTy4Z5XzMvHzV2p8wh+PPPey4jF969lg67l3WciQf1xb9jzKAf9yorOGDu6JT45I4i1DwYOGkJ1V+XNPGhKSegZ3JIP/SykyzyvfZKdl5yGM2pA9ddeJr5E7bd0esnVW6OrYTlx7DzEWfHLTTZXWPpufhMZb0Rsze1fllkT+T8p7rT7+jYfTHcjm9XykYRlctTLIeHf2636UM8bU7yQ=
  bucket: "zokrates"
  acl: public_read
  skip_cleanup: true

cache: cargo
before_cache:
  # Travis can't cache files that are not readable by "others"
  - chmod -R a+r $HOME/.cargo

# branches:
#   only:
#     # release tags
#     - /^\d+\.\d+\.\d+.*$/
#     - master

notifications:
  email:
    on_success: never
